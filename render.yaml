# Render Blueprint - MindStore with Cobalt + yt-dlp
# Deploys: Cobalt API + Downloader (yt-dlp) as 2 services
#
# Production URLs:
#   Cobalt API: https://mindstore-cobalt-api.onrender.com
#   Downloader: https://universal-video-downloader-2bv8.onrender.com

services:
  # 1. Cobalt API Server (custom image with Firebase cookie sync)
  # Automatically fetches cookies from Firebase backend on startup
  - type: web
    name: mindstore-cobalt-api
    runtime: docker
    dockerfilePath: cobalt-api/Dockerfile
    dockerContext: cobalt-api
    healthCheckPath: /
    envVars:
      - key: API_URL
        value: https://mindstore-cobalt-api.onrender.com
      - key: API_PORT
        value: 9000
      - key: CORS_WILDCARD
        value: "1"
      - key: CORS_URL
        value: "*"
      - key: COOKIE_PATH
        value: /cookies.json
      - key: BACKEND_URL
        value: https://mindstore-backend.onrender.com/api

  # 2. Downloader Server (your code: tries Cobalt â†’ then yt-dlp)
  - type: web
    name: universal-video-downloader
    runtime: docker
    dockerfilePath: cobalt-downloader/server/Dockerfile
    dockerContext: cobalt-downloader/server
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3002
      # Points to the Cobalt API service above
      - key: COBALT_URL
        value: https://mindstore-cobalt-api.onrender.com
      # Backend API for Drive upload and Firebase updates
      - key: BACKEND_URL
        value: https://mindstore-backend.onrender.com/api
      - key: ALLOWED_ORIGINS
        value: "*"
